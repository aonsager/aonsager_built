<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Rake task to backup MySQL to Amazon S3</title>
  <meta name="description" content="A simple rake task to dump the contents of a MySQL database and save it to an Amazon S3 bucket. Use together with whenever to automate it. namespace :backup ...">
  
  <link rel="stylesheet" href="/assets/css/main.css?v=20250102">
  <link rel="stylesheet" href="/assets/css/lightbox.min.css">
  <link rel="canonical" href="https://www.alexonsager.com/2013/11/29/rake-task-to-backup-mysql-to-amazon-s3.html">
  <link rel="alternate" type="application/rss+xml" title="Invisible Parade" href="/feed.xml">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
  <link rel="apple-touch-icon-precomposed" href="/assets/touchicon.png">
  <meta content="Invisible Parade" property="og:site_name">

  <meta content="Rake task to backup MySQL to Amazon S3" property="og:title">


  <meta content="article" property="og:type">


  <meta content="A simple rake task to dump the contents of a MySQL database and save it to an Amazon S3 bucket. Use together with whenever to automate it. namespace :backup ..." property="og:description">


  <meta content="https://www.alexonsager.com/2013/11/29/rake-task-to-backup-mysql-to-amazon-s3.html" property="og:url">


  <meta content="https://www.alexonsager.com/assets/touchicon.png" property="og:image">


  <script defer src="https://beans.alexonsager.com/script.js" data-website-id="87c0fa84-8d62-461c-a663-29faa9b2d902"></script>
</head>


  <body>

    <header class="site-header" role="banner">
  <div class="wrapper" style="position:relative;">
    
    
    <a class="site-title" href="/">
      <div class="logo-container">
        <div class="full" style="float:left;">
          <svg id="header-logo-black" width="80" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="20" cy="26" r="20" fill="#fdfdfd" stroke="black" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="40" cy="26" r="20" fill="black" />
          </svg>
          <svg id="header-logo-white" width="80" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="20" cy="26" r="20" fill="#2d2d2d" stroke="#c8c4bc" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="40" cy="26" r="20" fill="#c8c4bc" />
          </svg>
        </div>
        <div class="compact" style="float:left;">
          <svg id="header-logo-black" width="55" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="15" cy="24" r="12" fill="#fdfdfd" stroke="black" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="30" cy="24" r="12" fill="black" />
          </svg>
          <svg id="header-logo-white" width="55" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="15" cy="24" r="12" fill="#2d2d2d" stroke="#c8c4bc" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="30" cy="24" r="12" fill="#c8c4bc" />
          </svg>
        </div>
        <div style="float:left;">
          Invisible Parade
        </div>
      </div>
    </a>
  </div>
  <div class="header-banner"></div>
  
  <div class="wrapper">
    <nav class="site-nav">
      <a class="page-link" href="/about/">About</a>
      <!-- <a class="page-link" href="/projects/">Projects</a> -->
      <a class="page-link" href="/archive/">Archive</a>
      <a class="page-link" href="/feed.xml">RSS</a>
    </nav>
  </div>

</header>


    <main class="page-content" aria-label="Content">
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="wrapper">
    <header class="post-header">
      <span class="post-meta">
        <time datetime="2013-11-29T01:54:00+09:00" itemprop="datePublished">
          
          Nov 29, 2013
        </time>
      </span>
      <h1 class="post-title" itemprop="name headline">
        Rake task to backup MySQL to Amazon S3
      </h1>
      
    </header>

    <div class="post-content" itemprop="articleBody">
      


<div class="post-banner" style="background-image:linear-gradient(-45deg, #B0B0B0, #A8ABB1, #35276B, #56CA09, #919191)"></div>


      <p>A simple rake task to dump the contents of a MySQL database and save it to an Amazon S3 bucket. Use together with <a href="https://github.com/javan/whenever">whenever</a> to automate it.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">namespace</span> <span class="ss">:backup</span> <span class="k">do</span>

  <span class="n">task</span> <span class="ss">:nightly</span> <span class="k">do</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-%d_%H-%M-%S"</span><span class="p">)</span>
    <span class="n">backup_file</span> <span class="o">=</span> <span class="s2">"tmp/backups/</span><span class="si">#{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_dump.sql.gz"</span>
    <span class="sb">`mkdir -p tmp/backups`</span>
    <span class="sb">`mysqldump -u root {DATABASE_NAME} | gzip -c &gt; </span><span class="si">#{</span><span class="n">backup_file</span><span class="si">}</span><span class="sb">`</span>

    <span class="n">send_to_s3</span> <span class="n">backup_file</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">send_to_s3</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="s2">"{BUCKET_NAME}"</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="no">AWS</span><span class="o">::</span><span class="no">S3</span><span class="o">::</span><span class="no">DEFAULT_HOST</span><span class="p">.</span><span class="nf">replace</span> <span class="s2">"s3-us-west-2.amazonaws.com"</span>

    <span class="no">AWS</span><span class="o">::</span><span class="no">S3</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">establish_connection!</span><span class="p">(</span>
      <span class="ss">:access_key_id</span> <span class="o">=&gt;</span> <span class="s1">'{KEY}'</span><span class="p">,</span>
      <span class="ss">:secret_access_key</span> <span class="o">=&gt;</span> <span class="s1">'{SECRET}'</span><span class="p">)</span>

    <span class="no">AWS</span><span class="o">::</span><span class="no">S3</span><span class="o">::</span><span class="no">S3Object</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span>
      <span class="s2">"backups/</span><span class="si">#{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
      <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">"</span><span class="p">),</span>
      <span class="n">bucket</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div></div>

    </div>
  </div>

  
    <div class="post-tag">programming</div>
  
    <div class="post-tag">ruby</div>
  
    <div class="post-tag">tech</div>
  
    <div class="post-tag">script</div>
  
    <div class="post-tag">aws</div>
  

  <div class="post-related">
    <div class="wrapper">
      



<h4>Related Posts</h4>
<ul class="archive-list">

  
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
  
    
      
      
      
      
    
  
    
      
      
      
        
        <li><a href="/2013/06/04/behind-the-scenes-pokemon-fusion.html">Pokemon Fusion: Behind the Scenes</a></li>
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
  

  
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
        
        <li><a href="/2014/11/14/aws-lambda.html">AWS Lambda</a></li>
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
        
        <li><a href="/2014/08/10/missingno-in-pokemon-fusion.html">Missingno. in Pokemon Fusion</a></li>
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
        
        <li><a href="/2014/03/31/replace-text-in-file-osx-service.html">Replace Text in File - OSX Service</a></li>
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
      
    
  
    
      
      
      
        
        <li><a href="/2013/05/22/save-to-pocket-osx-service.html">Save to Pocket - OSX Service</a></li>
      
      
        
  
    
</ul>
    </div>
  </div>

  <div class="post-comments">
    <div class="wrapper">
      <script defer src="https://commento.alexonsager.com/js/commento.js"></script>
<div id="commento"></div>
    </div>
  </div>
</article>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      <div class="social-media-list">
        
          <a href="https://social.alexonsager.com/@alex"><div class="icon icon--fedi"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 1179 1000"><path fill="currentColor" d="M1179 465q0 126-79 233.5T885 868t-296 62q-122 0-234-39l2 3L0 1001q44-59 70.5-126.5T102 769l4-38Q0 611 0 465q0-126 79-233T293.5 63T589 1t296 62t215 169t79 233zm-250 0q0-29-21-50t-51-21q-29 0-50 21t-21 50q0 30 21 51t50 21q30 0 51-21t21-51zm-250 0q0-29-21-50t-51-21q-29 0-50 21t-21 50q0 30 21 51t50 21q30 0 51-21t21-51zm-250 0q0-29-21-50t-51-21q-29 0-50 21t-21 50q0 30 21 51t50 21q30 0 51-21t21-51z"/></svg></div></a>

        

        
          <a href="mailto:alex.onsager@gmail.com"><div class="icon icon--email"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 42 42"><path fill="currentColor" d="M40.5 31.5v-18S22.3 26.2 20.53 26.859C18.79 26.23.5 13.5.5 13.5v18c0 2.5.53 3 3 3h34c2.529 0 3-.439 3-3zm-.029-21.529c0-1.821-.531-2.471-2.971-2.471h-34c-2.51 0-3 .78-3 2.6l.03.28s18.069 12.44 20 13.12c2.04-.79 19.97-13.4 19.97-13.4l-.029-.129z"/></svg></div></a>

        

        
          <a href="https://github.com/aonsager"><div class="icon icon--github"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></a>

        
      </div>

    </div>

  </div>

</footer>


  </body>

</html>
