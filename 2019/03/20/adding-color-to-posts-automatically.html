<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Generating Colors from Post Titles</title>
  <meta name="description" content="My personal webpage and blog.">
  <link rel="stylesheet" href="/assets/css/main.css?v=202502192">
  <link rel="stylesheet" href="/assets/css/lightbox.min.css">
  <link rel="canonical" href="https://invisibleparade.com/2019/03/20/adding-color-to-posts-automatically.html">
  <link rel="alternate" type="application/rss+xml" title="Invisible Parade" href="/feed.xml">
  <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
  <link rel="shortcut icon" href="/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Invisible Parade" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta content="Invisible Parade" property="og:site_name">
<meta content="Generating Colors from Post Titles" property="og:title">
<meta content="article" property="og:type">
<meta content="This blog has an intentionally simple design, but lately I’ve been thinking that it needs more color. A lot of the posts don’t have images and are just text, so large areas of the page are black an..." property="og:description">
<meta content="https://invisibleparade.com/2019/03/20/adding-color-to-posts-automatically.html" property="og:url">
<script defer src="https://beans.alexonsager.com/script.js" data-website-id="5b90f085-e9ee-40a7-9b51-2fc1fa9ae0d4"></script>
</head>

<body>
  <header class="site-header" role="banner">
  <div class="wrapper" style="position:relative;">
    <a class="site-title" href="/">
      <div class="logo-container">
        <div class="full" style="float:left;">
          <svg id="header-logo-black" width="80" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="20" cy="26" r="20" fill="#fdfdfd" stroke="black" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="40" cy="26" r="20" fill="black" />
          </svg>
          <svg id="header-logo-white" width="80" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="20" cy="26" r="20" fill="#2d2d2d" stroke="#c8c4bc" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="40" cy="26" r="20" fill="#c8c4bc" />
          </svg>
        </div>
        <div class="compact" style="float:left;">
          <svg id="header-logo-black" width="55" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="15" cy="24" r="12" fill="#fdfdfd" stroke="black" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="30" cy="24" r="12" fill="black" />
          </svg>
          <svg id="header-logo-white" width="55" height="50" xmlns="http://www.w3.org/2000/svg">
            <circle cx="15" cy="24" r="12" fill="#2d2d2d" stroke="#c8c4bc" stroke-width="2" stroke-dasharray="2, 2" />
            <circle cx="30" cy="24" r="12" fill="#c8c4bc" />
          </svg>
        </div>
        <div style="float:left;">
          Invisible Parade
        </div>
      </div>
    </a>
  </div>
  <div class="header-banner"></div>
  <div class="wrapper">
    <nav class="site-nav">
      <a class="page-link" href="/">Home</a>
      <a class="page-link" href="/about/">About</a>
      <a class="page-link" href="/archive/">Archive</a>
      <a class="page-link" href="/feed.xml">RSS</a>
    </nav>
  </div>
</header>

  <main class="page-content" aria-label="Content">
    <article class="post wrapper" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
      <h1>
        <a class="post-link" href="/2019/03/20/adding-color-to-posts-automatically.html">Generating Colors from Post Titles</a>
      </h1>
      <div class="post-banner" style="background-image:linear-gradient(-45deg, #A27D7A, #927D67, #EFAB4D, #24919A, #535E5E)"></div>
</header>
    <div class="post-content single" itemprop="articleBody">
      <p>This blog has an intentionally simple design, but lately I’ve been thinking that it needs more color. A lot of the posts don’t have images and are just text, so large areas of the page are black and white with nothing visually interesting. That said, trying to include an image with every post is a pain. I would probably spend more time browsing stock images than actually writing the posts.</p>

<p><a href="https://picular.co">Picular</a> was a big inspiration. Generating colors from text by searching for images is a great idea, and I decided to automatically get a set of colors based on each post’s title. Picular doesn’t have an API that I could use, so I wrote a quick script that does something similar. Unless I’ve changed things since I published this post, there should now be a row of colors next to each post’s title.</p>

<!-- more -->

<h2 id="getting-colors-from-images">Getting colors from images</h2>

<p>I’ve included the script itself at the end of the post so you can the details of how it works, but the general process is as follows:</p>

<ol>
  <li>Do a Google Image search for the title of the post</li>
  <li>Get the first five images</li>
  <li>For each image, find the color that is most prominent</li>
  <li>Save the list of colors to the post</li>
</ol>

<p>Here are the results for the title “My Vacation in Tahiti”:</p>

<table>
  <tr>
    <td style="text-align:center"><img src="https://invisibleparade.com/assets/images/tahiti1.jpg" /></td>
    <td style="text-align:center"><img src="https://invisibleparade.com/assets/images/tahiti2.jpg" /></td>
    <td style="text-align:center"><img src="https://invisibleparade.com/assets/images/tahiti3.jpg" /></td>
    <td style="text-align:center"><img src="https://invisibleparade.com/assets/images/tahiti4.jpg" /></td>
    <td style="text-align:center"><img src="https://invisibleparade.com/assets/images/tahiti5.jpg" /></td>
  </tr>
  <tr>
    <td style="width:20%;text-align:center;background-color:#626E6F;color:white">#626E6F</td>
    <td style="width:20%;text-align:center;background-color:#53C2D6">#53C2D6</td>
    <td style="width:20%;text-align:center;background-color:#7693C6">#7693C6</td>
    <td style="width:20%;text-align:center;background-color:#39547B;color:white">#39547B</td>
    <td style="width:20%;text-align:center;background-color:#515E65;color:white">#515E65</td>
  </tr>
</table>
<p><br /></p>

<p>After playing around with it, I found that just looking at the most frequently used color usually isn’t good enough. Most of the time you just end up with a lot of black and white. Instead of looking for the most common color, I should instead look for the most interesting color. There is a lot of room for optimization here, and Picular probably does a lot behind the scenes to make its results visually appealing. For now, I’m just ignoring any colors that are close to black or close to white. So far it’s working well enough for my uses.</p>

<p>Even with these adjustments, this method tends to find a lot of colors that are either very dark or very bright. The colors often felt too strong compared to the rest of the site’s design. I thought about doing some adjustments to the colors to tone them down, but realized that it’s much easier to cheat by reducing the opacity of the colorful bars via CSS.</p>

<p>I now also include this script in the rake task that generates my post files for Jekyll, so after I write a post it will automatically fetch colors before publishing. I might write another post about how that works, but for now you can see the file <a href="https://github.com/aonsager/aonsager.github.io/blob/master/Rakefile">here</a> (sorry if I’ve changed things since I wrote this and it’s no longer there).</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li><a href="https://cse.google.com/cse/create/new">Create a custom search engine</a> powered by google</li>
  <li><a href="https://developers.google.com/custom-search/v1/overview">Get an API key</a> for the Custom Search JSON API</li>
</ul>

<p>This is the only good way that I have found to get image search results without using a credit card. The custom search engine requires that you specify a site to search when you create it, but you can change the settings to search the entire web afterwards and it works fine.</p>

<h2 id="the-script">The Script</h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/https'</span>
<span class="nb">require</span> <span class="s1">'uri'</span>
<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'yaml'</span>
<span class="nb">require</span> <span class="s1">'rmagick'</span>

<span class="no">CONFIG</span> <span class="o">=</span> <span class="no">YAML</span><span class="p">.</span><span class="nf">load_file</span><span class="p">(</span><span class="s2">"_local_config.yml"</span><span class="p">)</span>

<span class="c1"># Does an image search for the post title</span>
<span class="c1"># and returns 5 prominent colors</span>
<span class="k">def</span> <span class="nf">colors_from_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="c1"># Make the search query</span>
  <span class="n">uri</span>  <span class="o">=</span> <span class="s2">"https://www.googleapis.com"</span>
  <span class="n">path</span> <span class="o">=</span> <span class="s2">"/customsearch/v1"</span>
  <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">uri</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span>
            <span class="s2">"?key="</span> <span class="o">+</span> <span class="no">CONFIG</span><span class="p">[</span><span class="s1">'google_api_key'</span><span class="p">]</span> <span class="o">+</span>
            <span class="s2">"&amp;q="</span> <span class="o">+</span> <span class="no">URI</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">+</span>
            <span class="s2">"&amp;cx="</span> <span class="o">+</span> <span class="no">CONFIG</span><span class="p">[</span><span class="s1">'search_cx'</span><span class="p">]</span> <span class="o">+</span>
            <span class="s2">"&amp;searchType=image&amp;num=5"</span><span class="p">)</span>
  <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span>
    <span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span> <span class="ss">:use_ssl</span> <span class="o">=&gt;</span> <span class="n">uri</span><span class="p">.</span><span class="nf">scheme</span> <span class="o">==</span> <span class="s1">'https'</span>
  <span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
    <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Get the image results.</span>
  <span class="c1"># Using the thumbnails makes processing faster</span>
  <span class="n">image_urls</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">parsed_json</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
  <span class="n">parsed_json</span><span class="p">[</span><span class="s1">'items'</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="n">image_urls</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">[</span><span class="s1">'image'</span><span class="p">][</span><span class="s1">'thumbnailLink'</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="c1"># Process each image and get its most dominant color</span>
  <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">image_urls</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">image_url</span><span class="o">|</span>
    <span class="n">original</span> <span class="o">=</span> <span class="no">Magick</span><span class="o">::</span><span class="no">Image</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">image_url</span><span class="p">).</span><span class="nf">first</span>
    <span class="c1"># Reduce to 16 colors to speed up processing</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">original</span><span class="p">.</span><span class="nf">quantize</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="no">Magick</span><span class="o">::</span><span class="no">RGBColorspace</span><span class="p">)</span>
    <span class="c1"># Sort colors in order of frequency</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="nf">color_histogram</span><span class="p">.</span><span class="nf">sort</span> <span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
    <span class="c1"># Default to most common value, will try to replace</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="nf">to_color</span><span class="p">(</span><span class="n">palette</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">palette</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
      <span class="n">pixel</span> <span class="o">=</span> <span class="nb">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">hsl</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">.</span><span class="nf">to_HSL</span>
      <span class="k">if</span> <span class="n">hsl</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.3</span>
        <span class="c1"># Skip this color because too dark</span>
        <span class="k">next</span>
      <span class="k">elsif</span> <span class="n">hsl</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span>
        <span class="c1"># Skip this color because too light</span>
        <span class="k">next</span>
      <span class="k">else</span>
        <span class="c1"># Use this color</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="nf">to_color</span><span class="p">(</span><span class="n">pixel</span><span class="p">)</span>
        <span class="k">break</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">colors</span> <span class="o">&lt;&lt;</span> <span class="n">color</span>
  <span class="k">end</span>
  <span class="n">colors</span>
<span class="k">end</span>
</code></pre></div></div>

    </div>
    <div class="post-meta">
      Mar 20, 2019
    </div>
    <div class="post-tag">design</div>
    <div class="post-tag">blog</div>
    <div class="post-tag">color</div>
    <div class="post-tag">tool</div>
    <div class="post-tag">automation</div>
    <hr />
    <div class="post-related">
        <h4>Related Posts</h4>
<ul class="archive-list">
<li><a href="/2019/04/18/adding-css-support-for-dark-mode.html">Adding CSS Support for Dark Mode</a></li>
      <li><a href="/2018/08/30/picular.html">Picular - Google, but for Colors</a></li>
      <li><a href="/2014/03/24/terminal-theme.html">Terminal Theme</a></li>
      <li><a href="/2025/01/09/squirrel-archive-webpages-so-i-can-find-them-again.html">Squirrel - Archive webpages so I can find them again</a></li>
      <li><a href="/2024/11/27/comments-are-back.html">Comments are back</a></li>
      </ul></div>
    <hr />
    <div class="post-comments">
        <script defer src="https://commento.invisibleparade.com/js/commento.js"></script>
<div id="commento"></div>
</div>
  </article>

  </main>
  <footer class="site-footer">
  <div class="wrapper">
    <p>By Alex Onsager.&nbsp;&nbsp;&nbsp;<a href="/contact">Say hello!</a></p>
  </div>
</footer>

</body>
</html>
