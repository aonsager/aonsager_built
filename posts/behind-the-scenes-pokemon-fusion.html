<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pokemon Fusion: Behind the Scenes</title>
  <meta name="description" content="My personal webpage and blog.">
  <link rel="stylesheet" href="/assets/css/main.css?v=202504182">
  <link rel="stylesheet" href="/assets/css/lightbox.min.css">
  <link rel="canonical" href="https://invisibleparade.com/posts/behind-the-scenes-pokemon-fusion">
  <link rel="alternate" type="application/rss+xml" title="Invisible Parade" href="/feed.xml">
  <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
  <link rel="shortcut icon" href="/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Invisible Parade" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta content="Invisible Parade" property="og:site_name">
<meta content="Pokemon Fusion: Behind the Scenes" property="og:title">
<meta content="article" property="og:type">
<meta content="I’ve been getting a few questions about the script used to generate the Pokemon Fusion sprites, so I thought I would write a quick blog post to describe the process. The inspiration of the website ..." property="og:description">
<meta content="https://invisibleparade.com/posts/behind-the-scenes-pokemon-fusion" property="og:url">
<script defer src="https://beans.alexonsager.com/script.js" data-website-id="5b90f085-e9ee-40a7-9b51-2fc1fa9ae0d4"></script>
</head>

<body>
  
<header class="site-header mono">
  <div class="container">
    <div class="site-title">
      <svg id="header-logo" width="50" height="30" xmlns="http://www.w3.org/2000/svg">
        <circle cx="15" cy="15" r="10" fill="#fcfcfc" stroke="#202225" stroke-width="1" />
            <circle cx="25" cy="15" r="10" fill="#202225" stroke="#fcfcfc" stroke-width="1" />
      </svg>
      <svg id="nav-logo" width="50" height="30" xmlns="http://www.w3.org/2000/svg" onclick="toggle_nav();">
        <line x1="5" y1="10" x2="35" y2="10" />
        <line x1="5" y1="17" x2="35" y2="17" />
        <line x1="5" y1="24" x2="35" y2="24" />
      </svg>
      <button id="theme-toggle" aria-label="Toggle theme" style="background: none; border: none; cursor: pointer;" onclick="toggle_theme();">
        <svg id="theme-icon" width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"></svg>
      </button>
      <div class="site-url">
        <span class="header-url">invisibleparade.com</span><span class="header-url root-non-index blue">/posts<span class="blue-light">/behind-the-scenes-pokemon-fusion</span></span>
      </div>
    </div>
  </div>
</header>

<script>
  const themeToggleButton = document.getElementById('theme-toggle');
  const html = document.querySelector('html');
  const sunIcon = `
    <circle cx="15" cy="15" r="6" stroke="black" stroke-width="2" fill="none"/>
    <line x1="15" y1="2" x2="15" y2="6" stroke="black" stroke-width="2"/>
    <line x1="15" y1="24" x2="15" y2="28" stroke="black" stroke-width="2"/>
    <line x1="2" y1="15" x2="6" y2="15" stroke="black" stroke-width="2"/>
    <line x1="24" y1="15" x2="28" y2="15" stroke="black" stroke-width="2"/>
    <line x1="5.5" y1="5.5" x2="8.5" y2="8.5" stroke="black" stroke-width="2"/>
    <line x1="21.5" y1="21.5" x2="24.5" y2="24.5" stroke="black" stroke-width="2"/>
    <line x1="5.5" y1="24.5" x2="8.5" y2="21.5" stroke="black" stroke-width="2"/>
    <line x1="21.5" y1="8.5" x2="24.5" y2="5.5" stroke="black" stroke-width="2"/>
  `;
  const moonIcon = `
    <path d="M15 25C20.5228 25 25 20.5228 25 15C25 14.5373 24.3065 14.4608 24.0672 14.8568C22.9289 16.7406 20.8615 18 18.5 18C14.9101 18 12 15.0899 12 11.5C12 9.13845 13.2594 7.07105 15.1432 5.93276C15.5392 5.69347 15.4627 5 15 5C9.47715 5 5 9.47715 5 15C5 20.5228 9.47715 25 15 25Z" fill="#fdfdfd"/>
  `;

  // Check saved preference in localStorage
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const themeIcon = document.getElementById('theme-icon');

  function switchLight() {
    themeToggleButton.classList.remove('dark');
    html.style.setProperty("color-scheme", "light");
    themeIcon.innerHTML = sunIcon;
  }

  function switchDark() {
    themeToggleButton.classList.add('dark');
    html.style.setProperty("color-scheme", "dark");
    themeIcon.innerHTML = moonIcon;
  }

  if (savedTheme) {
    if (savedTheme === 'dark') {
      switchDark();
    } else if (savedTheme === 'light') {
      switchLight();
    }
  } else if (prefersDark) {
    themeIcon.innerHTML = moonIcon;
  } else {
    themeIcon.innerHTML = sunIcon;
  }

  function toggle_theme() {
    const isDark = themeToggleButton.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'light' : 'dark');
    if (isDark) {
      switchLight();
    } else {
      switchDark();
    }
  }

  function toggle_nav() {
    document.getElementById("nav-logo").classList.toggle('open');
    document.getElementById("site-nav").classList.toggle('open');
  }
</script>
  <main class="container flex">
    <nav id="site-nav" class="mono">
  <ul class="nav-links">
    <li class="red ">
      ❯&nbsp;<a href="/">/index</a>
    </li>
    <li class="green ">
      ❯&nbsp;<a href="/about">/about</a>
    </li>
    <li class="green-light ">
      &nbsp;&nbsp;❯&nbsp;<a href="/about/now">/now</a>
    </li>
    <li class="green-light ">
      &nbsp;&nbsp;❯&nbsp;<a href="/about/ai">/ai</a>
    </li>
    <li class="green-light ">
      &nbsp;&nbsp;❯&nbsp;<a href="/about/colophon">/colophon</a>
    </li>
    <li class="blue selected">
      ❯&nbsp;<a href="/posts">/posts</a>
    </li>
    <li class="blue-light ">
      &nbsp;&nbsp;❯&nbsp;<a href="/posts/archive">/archive</a>
    </li>
    <li class="blue-light ">
      &nbsp;&nbsp;&nbsp;&nbsp;❯&nbsp;<a href="/posts/archive/me">/me</a>
    </li>
    <li class="blue-light ">
      &nbsp;&nbsp;&nbsp;&nbsp;❯&nbsp;<a href="/posts/archive/games">/games</a>
    </li>
    <li class="blue-light ">
      &nbsp;&nbsp;&nbsp;&nbsp;❯&nbsp;<a href="/posts/archive/coding">/coding</span>
      </a>
    </li>
    <li class="blue-light ">
      &nbsp;&nbsp;&nbsp;&nbsp;❯&nbsp;<a href="/posts/archive/mumbles">/mumbles</a>
    </li>
    <li class="purple ">
      ❯&nbsp;<a href="/projects">/projects</a>
    </li>
    <li class="orange ">
      ❯&nbsp;<a href="/contact">/contact</a>
    </li>
    <li class="pink ">
      ❯&nbsp;<a href="/feeds">/feeds</a>
    </li>
  </ul>
</nav>
    <div class="page-content" aria-label="Content">
      <article class="post single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="post-flair" style="background-image: linear-gradient(90deg, #5D5E60, #E74F62, #F39C10, #B45932, #56472E);"></div>
  <header class="post-header">
    <h1>Pokemon Fusion: Behind the Scenes</h1>
    </header>
  <div class="post-content" itemprop="articleBody">
    <p>I’ve been getting a few questions about the script used to generate the <a href="http://pokemon.alexonsager.net">Pokemon Fusion</a> sprites, so I thought I would write a quick blog post to describe the process.</p>

<p>The inspiration of the website was the idea that it should be possible to automate the process of combining pokemon sprites, and each image is automatically generated by a computer script. Some of the results are less impressive than others, but I think that it adds to the fun and makes it that much more satisfying when you come across ones that work really well.</p>

<!-- more -->

<h2 id="preparation">Preparation</h2>

<p>There is a small amount of manual work that goes into adding a new pokemon to the website. It comes down to collecting some basic information about the head’s size and position, as well as the colors that are used.</p>

<p>First, I download the new pokemon’s sprite from <a href="http://bulbapedia.bulbagarden.net">Bulbapedia</a>, and manually cut out the head and save it as a new image. The body is also saved separately, and these become the basic parts that are combined with those from other pokemon to create the fusions.</p>

<p><img src="/assets/images/pokemon1.png" alt="Separating the head from the body" /></p>

<p>To collect and save each pokemon’s data, I made a simple admin page.</p>

<p><img src="/assets/images/pokemon2.png" alt="Admin page" /></p>

<ul>
  <li>Inputting the name as a prefix + suffix allows me to combine them to name the results.</li>
  <li><code class="language-plaintext highlighter-rouge">Face size</code> is taken automatically from the size of the image, and <code class="language-plaintext highlighter-rouge">Head size</code> is used to adjust for unusually-shaped faces. In this example, I wanted the lower jaw and whiskers to hang below the main head location so I set the head size to be smaller, matching the colored-out area of the body.
    <ul>
      <li>To make setting the face’s size and position easier, there’s a little javascript that lets me click on a point on the image to output the coordinates automatically.</li>
    </ul>
  </li>
  <li>The basic idea behind the colors is that each sprite will have at most 3 different colors, with at most 5 shades of each color. The 3rd shade of each color is set to be the primary color, with the 2 shades on either side defining highlights and shadows.
    <ul>
      <li>I made a little script here too, that lets me click on a point in the image to automatically output the hex value of that pixel.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/images/pokemon3.png" alt="Color picker widget" /></p>

<p>After all of the data is saved, I run my fusion script to combine the new pokemon with all of the existing pokemon. At this point, by just adding a few data points for a new pokemon I can generate over 100 new fusions nearly instantly.</p>

<h2 id="the-script">The script</h2>

<p>The image processing is done with ImageMagick, and I use the RMagick gem to work with it in Ruby. I plan to open source the code after I clean things up more, but here are the most important parts:</p>

<h3 id="swap-the-colors-to-match-the-new-face">Swap the colors to match the new face</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">body1</span> <span class="o">=</span> <span class="n">body1</span><span class="p">.</span><span class="nf">opaque_channel</span><span class="p">(</span><span class="s2">"#</span><span class="si">#{</span><span class="n">pk1</span><span class="p">[</span><span class="s1">'primary'</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span><span class="s2">"#</span><span class="si">#{</span><span class="n">pk2</span><span class="p">[</span><span class="s1">'primary'</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></div>

<p>This code looks at the image <code class="language-plaintext highlighter-rouge">body1</code> for every pixel of the given color <code class="language-plaintext highlighter-rouge">pk1['primary'][i]</code> and changes it to the second given color <code class="language-plaintext highlighter-rouge">pk2['primary'][i]</code>. We will then loop for each of the 5 shades of each of the 3 colors.</p>

<h3 id="resize-the-face-to-match-its-new-body">Resize the face to match its new body</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">headratiox1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">pk2</span><span class="p">[</span><span class="s1">'headsize'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">pk1</span><span class="p">[</span><span class="s1">'headsize'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">headratioy1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">pk2</span><span class="p">[</span><span class="s1">'headsize'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">pk1</span><span class="p">[</span><span class="s1">'headsize'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

	<span class="n">newx</span> <span class="o">=</span> <span class="n">pk1</span><span class="p">[</span><span class="s1">'facesize'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">headratiox1</span>
	<span class="n">newy</span> <span class="o">=</span> <span class="n">pk1</span><span class="p">[</span><span class="s1">'facesize'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">headratioy1</span>

	<span class="n">face1</span> <span class="o">=</span> <span class="n">face1</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="n">newx</span><span class="p">,</span> <span class="n">newy</span><span class="p">)</span>
</code></pre></div></div>

<p>First, we compare the heads of the two pokemon and see much bigger/smaller the <strong>head</strong> we’re working with is. Once we have this ratio, we resize the <strong>face</strong> image by this ratio.</p>

<p>Since we made defined the head to be smaller than the face (to support irregular faces with beaks, tongues, or whiskers that spill over the head area), this makes sure that the face image isn’t shrunken down too much.</p>

<h3 id="put-the-head-in-the-right-place">Put the head in the right place</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">body1</span> <span class="o">=</span> <span class="n">body1</span><span class="p">.</span><span class="nf">composite</span><span class="p">(</span><span class="n">face2</span><span class="p">,</span> <span class="n">face2x</span><span class="p">,</span> <span class="n">face2y</span><span class="p">,</span> <span class="no">Magick</span><span class="o">::</span><span class="no">OverCompositeOp</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">composite</code> is the function that overlays an image over another image, and here we are placing the image <code class="language-plaintext highlighter-rouge">face2</code> on top of the image <code class="language-plaintext highlighter-rouge">body1</code> at the coordinates <code class="language-plaintext highlighter-rouge">(face2x, face2y)</code>.</p>

<h3 id="thats-it">That’s it!</h3>

<p>After looping over each existing pokemon the script generates all new combinations using the new pokemon, and I just upload the new images and update the site to show the new combinations.</p>

<p><img src="/assets/images/pokemon4.png" alt="The results" /></p>

<p>If you have any other questions, feel free to reach out over email or twitter.</p>

<p><em>Edit: Because I’ve been getting a lot of questions about it, I’ll mention here that I only plan to support the first 151 pokemon for the site. Thanks for your understanding.</em></p>

    <div class="post-meta">
      <time datetime="2013-06-04T00:41:00+09:00" itemprop="datePublished">
        Jun 4, 2013
      </time>
    </div>
  </div>
  <hr />
  <div class="post-related">
      <h3>Related Posts</h3>
<ul class="archive-list">
<li><a href="/posts/rake-task-to-backup-mysql-to-amazon-s3">Rake task to backup MySQL to Amazon S3</a></li>
      <li><a href="/posts/computer-program-that-learns-to-play-classic-nes-games">Computer program that learns to play classic NES games</a></li>
      <li><a href="/posts/litestack-all-your-data-infrastructure">Litestack: All your data infrastructure</a></li>
      <li><a href="/posts/reimagining-chess-with-alphazero">Reimagining Chess with AlphaZero</a></li>
      <li><a href="/posts/why-switch-cartridges-taste-awful">Why Switch Cartridges Taste Awful</a></li>
      </ul></div>
  <hr />
  <div class="post-comments">
      <script defer src="https://commento.invisibleparade.com/js/commento.js"></script>
<div id="commento"></div>
</div>
</article>
  
    </div>
  </main>
  <footer class="site-footer mono">
  <div class="wrapper">
    <p>By Alex Onsager. <a href="/contact">Say hello!</a></p>
  </div>
</footer>

<script src="/assets/js/lightbox-plus-jquery.min.js"></script>
<script>
  // Lightbox
    lightbox.option({
      'alwaysShowNavOnTouchDevices': true,
      'fadeDuration': 200,
      'imageFadeDuration': 0,
      'resizeDuration': 0,
      'wrapAround': true
    })
</script>
</body>
</html>
